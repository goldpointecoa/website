<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Gold Pointe Condo Owner's Association</title>
    <link rel="stylesheet" href="css/styles.css">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- CryptoJS library for encryption -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <!-- StatiCrypt script -->
    <script src="js/staticrypt.js"></script>
    <style>
        .admin-container {
            max-width: 1000px;
            margin: 50px auto;
            padding: 30px;
            background-color: #fff;
            border-radius: 5px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .status-message {
            margin-top: 20px;
            padding: 15px;
            border-radius: 4px;
            display: none;
        }
        
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .editor-container {
            display: none;
            margin-top: 30px;
        }

        #editor {
            width: 100%;
            min-height: 400px;
            font-family: monospace;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            resize: vertical;
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-bottom: none;
            border-radius: 4px 4px 0 0;
            margin-right: 5px;
        }

        .tab.active {
            background-color: white;
            border-bottom: 3px solid var(--primary-color);
            font-weight: bold;
        }

        .admin-section {
            display: none;
            padding: 20px;
            border: 1px solid #dee2e6;
            border-radius: 0 4px 4px 4px;
        }

        .admin-section.active {
            display: block;
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">
            <h1>Gold Pointe</h1>
            <p>Condo Owner's Association</p>
        </div>
        <nav>
            <button class="menu-toggle" aria-label="Toggle menu">
                <i class="fas fa-bars"></i>
            </button>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="about.html">About</a></li>
                <li><a href="resources.html">Resources</a></li>
                <li><a href="contact.html">Contact</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <div class="admin-container">
            <h2>Admin Dashboard</h2>
            <p>Use this tool to manage the password-protected resources page.</p>
            
            <div class="tabs">
                <div class="tab active" data-section="encrypt">Encrypt Resources</div>
                <div class="tab" data-section="edit">Edit Resources</div>
                <div class="tab" data-section="preview">Preview Original</div>
                <div class="tab" data-section="help">Help</div>
            </div>
            
            <div class="admin-section active" id="encrypt-section">
                <h3>Encrypt Resources Page</h3>
                <p>Here you can encrypt the resources page with a password. This will take the content from resources-original.html, encrypt it, and save it as resources.html.</p>
                
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" value="goldpointe2025" class="password-input">
                </div>
                
                <div class="btn-group">
                    <button id="encrypt-btn" class="btn">Encrypt Resources Page</button>
                    <button id="view-original-btn" class="btn secondary">View Original</button>
                    <button id="view-encrypted-btn" class="btn secondary">View Encrypted</button>
                </div>
                
                <div id="encrypt-status" class="status-message"></div>
            </div>
            
            <div class="admin-section" id="edit-section">
                <h3>Edit Resources Content</h3>
                <p>Make changes to the original resources page content below. Remember to save your changes and then encrypt the page afterwards.</p>
                
                <div class="editor-container" style="display: block;">
                    <textarea id="editor"></textarea>
                </div>
                
                <div class="btn-group">
                    <button id="load-content-btn" class="btn secondary">Load Content</button>
                    <button id="save-content-btn" class="btn">Save Changes</button>
                </div>
                
                <div id="edit-status" class="status-message"></div>
            </div>
            
            <div class="admin-section" id="preview-section">
                <h3>Preview Original Resources Page</h3>
                <p>This shows a preview of the original resources page (resources-original.html) before encryption.</p>
                
                <div class="btn-group">
                    <button id="load-preview-btn" class="btn">Load Preview</button>
                </div>
                
                <div id="preview-container" style="margin-top: 20px; border: 1px solid #ddd; padding: 20px; min-height: 300px;">
                    <p>Click "Load Preview" to see the current resources page content.</p>
                </div>
            </div>
            
            <div class="admin-section" id="help-section">
                <h3>How to Update the Resources Page</h3>
                
                <h4>Workflow for Updating the Resources Page</h4>
                <ol>
                    <li>Go to the "Edit Resources" tab</li>
                    <li>Click "Load Content" to load the current version</li>
                    <li>Make your changes to the HTML content</li>
                    <li>Click "Save Changes" to update resources-original.html</li>
                    <li>Go to the "Encrypt Resources" tab</li>
                    <li>Enter the password (default is "goldpointe2025")</li>
                    <li>Click "Encrypt Resources Page"</li>
                    <li>A download will start with the encrypted version of resources.html</li>
                    <li>Replace the existing resources.html file with this downloaded file</li>
                </ol>
                
                <h4>Important Notes</h4>
                <ul>
                    <li>The file resources-original.html is your master file that you should edit</li>
                    <li>The file resources.html is the encrypted version that visitors will see</li>
                    <li>You can preview the original page before encrypting using the "Preview Original" tab</li>
                    <li>When deploying to Netlify, resources-original.html will not be included (it's in the .gitignore file)</li>
                </ul>
            </div>
        </div>
    </main>

    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>Gold Pointe COA</h3>
                <p>123 Gold Avenue<br>Anytown, ST 12345</p>
                <p>Phone: (555) 123-4567</p>
                <p>Email: info@goldpointecoa.com</p>
            </div>
            <div class="footer-section">
                <h3>Quick Links</h3>
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="about.html">About</a></li>
                    <li><a href="resources.html">Resources</a></li>
                    <li><a href="contact.html">Contact</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2023 Gold Pointe Condo Owner's Association. All rights reserved.</p>
        </div>
    </footer>

    <script src="js/main.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Mobile menu toggle
            const menuToggle = document.querySelector('.menu-toggle');
            const navLinks = document.querySelector('.nav-links');
            
            if (menuToggle) {
                menuToggle.addEventListener('click', function() {
                    navLinks.classList.toggle('active');
                });
            }
            
            // Add current year to footer copyright
            const yearElement = document.querySelector('.footer-bottom p');
            if (yearElement) {
                const currentYear = new Date().getFullYear();
                yearElement.innerHTML = yearElement.innerHTML.replace('2023', currentYear);
            }
            
            // Tab functionality
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // Remove active class from all tabs
                    tabs.forEach(t => t.classList.remove('active'));
                    // Add active class to clicked tab
                    tab.classList.add('active');
                    
                    // Hide all sections
                    document.querySelectorAll('.admin-section').forEach(section => {
                        section.classList.remove('active');
                    });
                    
                    // Show the corresponding section
                    const sectionId = tab.getAttribute('data-section') + '-section';
                    document.getElementById(sectionId).classList.add('active');
                });
            });
            
            // Encryption functionality
            const encryptBtn = document.getElementById('encrypt-btn');
            const viewOriginalBtn = document.getElementById('view-original-btn');
            const viewEncryptedBtn = document.getElementById('view-encrypted-btn');
            const passwordInput = document.getElementById('password');
            const encryptStatus = document.getElementById('encrypt-status');
            
            // Edit functionality
            const editor = document.getElementById('editor');
            const loadContentBtn = document.getElementById('load-content-btn');
            const saveContentBtn = document.getElementById('save-content-btn');
            const editStatus = document.getElementById('edit-status');
            
            // Preview functionality
            const loadPreviewBtn = document.getElementById('load-preview-btn');
            const previewContainer = document.getElementById('preview-container');
            
            // Encryption section buttons
            if (encryptBtn) {
                encryptBtn.addEventListener('click', async function() {
                    const password = passwordInput.value.trim();
                    
                    if (!password) {
                        showStatus(encryptStatus, 'Please enter a password.', 'error');
                        return;
                    }
                    
                    showStatus(encryptStatus, 'Encrypting resources page...', 'info');
                    
                    try {
                        // First, try to load resources-original.html
                        const originalResponse = await fetch('resources-original.html');
                        let content;
                        
                        if (originalResponse.ok) {
                            content = await originalResponse.text();
                            console.log('resources-original.html found and loaded');
                        } else {
                            // If resources-original.html doesn't exist, try resources.html
                            console.log('resources-original.html not found, trying resources.html');
                            const resourcesResponse = await fetch('resources.html');
                            if (resourcesResponse.ok) {
                                content = await resourcesResponse.text();
                            } else {
                                throw new Error('Could not load resources content');
                            }
                        }
                        
                        // Now encrypt the content
                        const encryptedHtml = await StaticryptFunctions.encryptContent(content, password);
                        
                        // Create a download link for the encrypted file
                        const blob = new Blob([encryptedHtml], { type: 'text/html' });
                        const url = URL.createObjectURL(blob);
                        
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = 'resources.html';
                        a.style.display = 'none';
                        
                        document.body.appendChild(a);
                        a.click();
                        
                        // Clean up
                        setTimeout(() => {
                            document.body.removeChild(a);
                            URL.revokeObjectURL(url);
                        }, 100);
                        
                        showStatus(encryptStatus, 'Resources page encrypted successfully! The encrypted file has been downloaded. Replace the existing resources.html with this file.', 'success');
                    } catch (error) {
                        showStatus(encryptStatus, 'Error encrypting resources page: ' + error.message, 'error');
                        console.error(error);
                    }
                });
            }
            
            if (viewOriginalBtn) {
                viewOriginalBtn.addEventListener('click', function() {
                    window.open('resources-original.html', '_blank');
                });
            }
            
            if (viewEncryptedBtn) {
                viewEncryptedBtn.addEventListener('click', function() {
                    window.open('resources.html', '_blank');
                });
            }
            
            // Edit section buttons
            if (loadContentBtn) {
                loadContentBtn.addEventListener('click', async function() {
                    try {
                        // First try to load resources-original.html
                        const originalResponse = await fetch('resources-original.html');
                        let content;
                        
                        if (originalResponse.ok) {
                            content = await originalResponse.text();
                        } else {
                            // If that fails, try resources.html
                            const resourcesResponse = await fetch('resources.html');
                            if (resourcesResponse.ok) {
                                content = await resourcesResponse.text();
                            } else {
                                throw new Error('Could not load resources content');
                            }
                        }
                        
                        editor.value = content;
                        showStatus(editStatus, 'Content loaded successfully.', 'success');
                    } catch (error) {
                        showStatus(editStatus, 'Error loading content: ' + error.message, 'error');
                        console.error(error);
                    }
                });
            }
            
            if (saveContentBtn) {
                saveContentBtn.addEventListener('click', async function() {
                    const content = editor.value.trim();
                    
                    if (!content) {
                        showStatus(editStatus, 'Content cannot be empty.', 'error');
                        return;
                    }
                    
                    try {
                        // Create a download link for the content
                        const blob = new Blob([content], { type: 'text/html' });
                        const url = URL.createObjectURL(blob);
                        
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = 'resources-original.html';
                        a.style.display = 'none';
                        
                        document.body.appendChild(a);
                        a.click();
                        
                        // Clean up
                        setTimeout(() => {
                            document.body.removeChild(a);
                            URL.revokeObjectURL(url);
                        }, 100);
                        
                        showStatus(editStatus, 'Content saved. Download started for resources-original.html. Replace the existing file with this downloaded file.', 'success');
                    } catch (error) {
                        showStatus(editStatus, 'Error saving content: ' + error.message, 'error');
                        console.error(error);
                    }
                });
            }
            
            // Preview section buttons
            if (loadPreviewBtn) {
                loadPreviewBtn.addEventListener('click', async function() {
                    try {
                        // Try to load resources-original.html
                        const originalResponse = await fetch('resources-original.html');
                        let content;
                        
                        if (originalResponse.ok) {
                            content = await originalResponse.text();
                        } else {
                            // If that fails, try resources.html
                            const resourcesResponse = await fetch('resources.html');
                            if (resourcesResponse.ok) {
                                content = await resourcesResponse.text();
                            } else {
                                throw new Error('Could not load resources content');
                            }
                        }
                        
                        // Create an iframe to display the content
                        previewContainer.innerHTML = '<iframe id="preview-frame" style="width:100%; height:600px; border:none;"></iframe>';
                        const iframe = document.getElementById('preview-frame');
                        const iframeDoc = iframe.contentWindow.document;
                        
                        iframeDoc.open();
                        iframeDoc.write(content);
                        iframeDoc.close();
                    } catch (error) {
                        previewContainer.innerHTML = '<p class="error">Error loading preview: ' + error.message + '</p>';
                        console.error(error);
                    }
                });
            }
            
            // Helper functions
            function showStatus(element, message, type) {
                element.textContent = message;
                element.className = 'status-message ' + type;
                element.style.display = 'block';
                
                // Scroll to the message
                element.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
            
            // Load content on page load if on edit tab
            if (window.location.hash === '#edit' && editor && loadContentBtn) {
                loadContentBtn.click();
            }
        });
    </script>
</body>
</html>